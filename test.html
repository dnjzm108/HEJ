<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Api</title>
    <script type="text/javascript">
        /*
            https://dapi.kakao.com/v2/local/search/address.json?analyze_type=similar&page=1&size=10&query=
            headers ->  Authorization: KakaoAK {REST_API_KEY}
            REST_API_KET : 82ff941469e77067f4ed407f2d33553d
       
        */
        document.addEventListener('DOMContentLoaded', init);
        function init() {
            // let options= {
            //     method:'GET',
            //     headers:{
            //         "Authorization":"KakaoAK 82ff941469e77067f4ed407f2d33553d"
            //     }
            // }
            // let result= await fetch('https://dapi.kakao.com/v2/local/search/address.json?analyze_type=similar&page=1&size=10&query=서울특별시 강동구 천호동 올림픽로 651', options)
            // let json = await result.json();
            // console.log(json);
            const searchBtn = document.querySelector('#addressSearch');
            searchBtn.addEventListener('click', getAddress);
        }

        async function getAddress() {
            const addressInput = document.querySelector('#addressInput');
            const addressList = document.querySelector('#addressList');
            console.log(addressInput.value);
            if(addressInput.value.length ==0){
                alert('주소를 입력해주세요.');
                addressInput.focus();
                return false;
            } //주소창 결과값이 아무것도 입력되지 않았을때 얼럴트창이뜨고 커서가 주소창으로 옴겨짐.

            let options = {
                method: 'GET',
                headers: {
                    "Authorization": "KakaoAK 82ff941469e77067f4ed407f2d33553d"
                }
            }
            let result = await fetch('https://dapi.kakao.com/v2/local/search/address.json?analyze_type=similar&page=1&size=10&query=' + addressInput.value, options)
            let json = await result.json();

            addressList.innerHTML = '';
            if(json.documents.length == 0){
                addressList.innerHTML = '<li>결과값이 존재하지 않습니다.</li>';
                return false;
            }

            json.documents.forEach(v => {
                console.log(v.address_name);
                const li = document.createElement('li')
                li.innerHTML = v.address_name;
                li.dataset.x = v.x;
                li.dataset.y = v.y; //첫번째 인자값의 요소에 있는 y를 dataset y 값에 넣겟다.
                li.addEventListener('click', getAddressDetail);
                addressList.appendChild(li);
            })
        }

        async function getAddressDetail() {
            let x = this.dataset.x;
            let y = this.dataset.y;

            let options = {
                method: 'GET',
                headers: {
                    "Authorization": "KakaoAK 82ff941469e77067f4ed407f2d33553d"
                }
            }

            //https://dapi.kakao.com/v2/local/geo/coord2address.json?input_coord=WGS84&y=37.5397559555383&x=127.123313958545
            let url = `https://dapi.kakao.com/v2/local/geo/coord2address.json?input_coord=WGS84&x=${x}&y=${y}`
            let result = await fetch(url, options) // 요청의 결과값만 반환해줌
            let json = await result.json();     // 응답의 body영역을 읽기위해 body영역의 타입이 application/json 타입으로 오기떄문

            console.log(json);

            if (json.documents[0].road_address == null) {
                let address_name = json.documents[0].address.address_name; 
                document.querySelector('#address1').value = `${address_name} `;
            
                
            } else {
                let address_name = json.documents[0].road_address.address_name;
                let buliding_name = json.documents[0].road_address.building_name;
                let zone_no = json.documents[0].road_address.zone_no;

                document.querySelector('#addressNumber').value = zone_no;
                document.querySelector('#address1').value = `${address_name} ${buliding_name}`;


            }
        }
    </script>
</head>

<body>
    <div>
        <input type="text" id="addressInput" name="addressInput" placeholder="주소를 입력해주세요.">
        <button id="addressSearch">주소검색하기</button>
    </div>
    <ul id="addressList">

    </ul>
    <input type="text" name="addressNumber" id="addressNumber" size="10" placeholder="우편번호">
    <input type="text" name="address1" id="address1" size="40" placeholder="주소">
    <input type="text" name="address2" id="address2" placeholder="상세주소">

</body>

</html>